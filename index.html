<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Predicciones UFC</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 20px; }
    h1, h2 { text-align: center; }
    .fight, .login-box, .panel-box, .admin-box, .ranking-box {
      background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px;
    }
    label { margin-right: 15px; }
    .section { max-width: 800px; margin: auto; }
    .submit-btn { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; }
    .method { margin-top: 10px; }
    .hidden { display: none; }
    input[type="text"], input[type="password"], select {
      width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; box-sizing: border-box;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eee; }
    .acierto { background-color: #d4edda; }
    .fallo { background-color: #f8d7da; }
    nav { background:#111; padding:10px; text-align:center; margin-bottom:20px; }
    nav a { color:white; margin:0 15px; text-decoration:none; }
  </style>

  <!-- Firebase SDKs compat -->
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <nav>
    <a href="stats.html">ðŸ“Š EstadÃ­sticas</a>
    <a href="historial.html">ðŸ“’ Historial</a>
  </nav>

  <h1>Predicciones UFC</h1>

  <div class="section" id="login-section">
    <div class="login-box">
      <h2>Iniciar sesiÃ³n</h2>
      <label for="username">Usuario:</label>
      <input type="text" id="username">
      <label for="password">ContraseÃ±a:</label>
      <input type="password" id="password">
      <label for="event-selector">Selecciona evento:</label>
      <select id="event-selector">
        <option value="ufc304">UFC 304 - Whittaker vs de Ridder</option>
        <option value="ufcApex108">UFC Apex 108 - Taira vs Park</option>
        <option value="ufcApex109">UFC Apex 109 - Dolidze vs Hernandez</option>
      </select>
      <button onclick="login()">Entrar</button>
      <button onclick="localStorage.clear(); alert('LocalStorage limpiado');">Borrar LocalStorage</button>
    </div>
  </div>

  <div class="section hidden" id="prediction-section">
    <h2 id="welcome-user"></h2>
    <div id="fight-list"></div>
    <button class="submit-btn" id="submit-btn" onclick="submitPredictions()">Enviar Predicciones</button>
  </div>

  <div class="section hidden" id="admin-section">
    <div class="admin-box">
      <h2>Panel de Admin</h2>
      <p>(AÃºn por implementar)</p>
    </div>
  </div>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyASAZyQrO2m03A46_gILD_tyUenkRn3HXA",
    authDomain: "prediccionesufc.firebaseapp.com",
    projectId: "prediccionesufc",
    storageBucket: "prediccionesufc.appspot.com",
    messagingSenderId: "372069968923",
    appId: "1:372069968923:web:cba4dc58e880214dc49cbe"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const users = {
    "david": "clave",
    "esteban": "lebron",
    "cabas": "curry13",
    "pingon": "pinga",
    "admin": "1"
  };

  const eventos = {
    ufc304: {
      nombre: "UFC 304 - Whittaker vs de Ridder",
      peleas: [
        { id: "pele1", nombre: "Peleador A vs Peleador B", tipo: "Preliminar" },
        { id: "pele2", nombre: "Luchador X vs Luchador Y", tipo: "Main Card", estelar: true }
      ]
    },
    ufcApex108: {
      nombre: "UFC Apex 108 - Taira vs Park",
      peleas: [
        { id: "pele3", nombre: "Taira vs Park", tipo: "Main Card", estelar: true }
      ]
    },
    ufcApex109: {
      nombre: "UFC Apex 109 - Dolidze vs Hernandez",
      peleas: [
        { id: "pele4", nombre: "Dolidze vs Hernandez", tipo: "Preliminar" }
      ]
    }
  };

  let currentUser = null;
  let currentEvent = null;
  let isAdmin = false;

  function login() {
    const user = document.getElementById("username").value.toLowerCase();
    const pass = document.getElementById("password").value;
    const event = document.getElementById("event-selector").value;

    if (users[user] && users[user] === pass) {
      currentUser = user;
      currentEvent = event;
      isAdmin = user === "admin";

      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("prediction-section").classList.remove("hidden");
      document.getElementById("welcome-user").innerText = `Bienvenido, ${user} | ${eventos[event].nombre}`;

      if (isAdmin) {
        document.getElementById("admin-section").classList.remove("hidden");
      } else {
        renderFights();
      }

    } else {
      alert("Usuario o contraseÃ±a incorrectos");
    }
  }

  function renderFights() {
    const container = document.getElementById("fight-list");
    container.innerHTML = "";

    const fights = eventos[currentEvent].peleas;

    fights.forEach(f => {
      const div = document.createElement("div");
      div.classList.add("fight");
      div.innerHTML = `
        <strong>${f.nombre}</strong><br>
        <label><input type="radio" name="fight_${f.id}" value="1"> Luchador A</label>
        <label><input type="radio" name="fight_${f.id}" value="2"> Luchador B</label>
      `;

      if (f.tipo === "Main Card") {
        div.innerHTML += `
          <div class="method">
            <label>MÃ©todo de victoria:</label>
            <select id="method_${f.id}">
              <option value="">Selecciona...</option>
              <option value="KO">KO</option>
              <option value="SUB">SUB</option>
              <option value="DEC">DEC</option>
            </select>
          </div>
        `;
      }

      container.appendChild(div);
    });
  }

  async function submitPredictions() {
    const fights = eventos[currentEvent].peleas;
    const predictions = [];

    for (const f of fights) {
      const ganador = document.querySelector(`input[name=fight_${f.id}]:checked`);
      if (!ganador) return alert(`Debes elegir un ganador para ${f.nombre}`);
      const metodo = f.tipo === "Main Card" ? document.getElementById(`method_${f.id}`).value : null;
      if (f.tipo === "Main Card" && !metodo) return alert(`Debes elegir mÃ©todo para ${f.nombre}`);

      predictions.push({
        pelea: f.id,
        tipo: f.tipo,
        estelar: f.estelar || false,
        ganador: ganador.value,
        metodo: metodo
      });
    }

    try {
      await db.collection("predicciones").add({
        usuario: currentUser,
        evento: currentEvent,
        predicciones: predictions
      });
      alert("Predicciones guardadas con Ã©xito");
      document.getElementById("submit-btn").style.display = "none";
    } catch (error) {
      console.error("Error guardando predicciones:", error);
      alert("Error guardando en Firestore");
    }
  }
</script>

</body>
</html>

